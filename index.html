<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trivia Naturaleza (para 4b escuela sarmiento): Aventura Animal y Vegetal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(to bottom, #a7f3d0, #f0fdf4); /* Tailwind bg-emerald-200 to bg-emerald-50 */
        }
        .quiz-container {
            background-color: rgba(255, 255, 255, 0.9); /* Fondo blanco semi-transparente */
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 87, 38, 0.2); /* Sombra m√°s verdosa */
            border: 1px solid rgba(34, 197, 94, 0.3); /* Borde sutil verde */
        }
        .option-button {
            transition: all 0.2s ease-in-out;
            border-width: 2px;
            background-color: #dcfce7; /* Tailwind bg-green-100 */
            border-color: #86efac; /* Tailwind border-green-300 */
            color: #166534; /* Tailwind text-green-800 */
        }
        .option-button:hover {
            transform: scale(1.03);
            background-color: #bbf7d0; /* Tailwind bg-green-200 */
            border-color: #4ade80; /* Tailwind border-green-400 */
        }
        .correct-answer {
            background-color: #86efac !important; /* Tailwind bg-green-300 */
            border-color: #22c55e !important; /* Tailwind border-green-500 */
            color: #14532d !important; /* Tailwind text-green-900 */
            font-weight: bold;
        }
        .incorrect-answer {
            background-color: #fecaca !important; /* Tailwind bg-red-200 */
            border-color: #f87171 !important; /* Tailwind border-red-400 */
            color: #991b1b !important; /* Tailwind text-red-800 */
        }
        .feedback-icon {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        .progress-bar-container {
            height: 12px; /* Un poco m√°s gruesa */
            background-color: #d1fae5; /* Tailwind bg-emerald-100 */
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 1rem;
            border: 1px solid #6ee7b7; /* Tailwind border-emerald-300 */
        }
        .progress-bar {
            height: 100%;
            background-color: #10b981; /* Tailwind bg-emerald-500 */
            transition: width 0.3s ease-in-out;
            border-radius: 6px;
        }
        /* Animaci√≥n para aparici√≥n de elementos */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
        }
        /* Botones principales con gradiente verde */
        .main-button { /* Clase gen√©rica para botones principales */
            background-image: linear-gradient(to right, #10b981, #34d399); /* Tailwind bg-emerald-500 to bg-emerald-400 */
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
            color: white;
            font-weight: bold;
            padding: 0.75rem 1.5rem; /* py-3 px-6 */
            border-radius: 9999px; /* rounded-full */
            transition: all 0.3s ease-in-out;
            transform: scale(1);
            display: inline-flex; /* Para alinear √≠cono y texto */
            align-items: center;
            justify-content: center;
        }
        .main-button:hover {
            background-image: linear-gradient(to right, #059669, #10b981); /* Tailwind bg-emerald-600 to bg-emerald-500 */
            box-shadow: 0 6px 20px rgba(5, 150, 105, 0.4);
            transform: scale(1.05);
        }
        .main-button i { /* Estilo para √≠conos dentro de los botones */
            margin-right: 0.5rem;
        }

        /* Estilos para el interruptor de modo aleatorio */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #9ca3af; /* Tailwind bg-gray-400 */
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #059669; /* Tailwind bg-emerald-600 */
        }
        input:focus + .slider {
            box-shadow: 0 0 1px #059669;
        }
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        /* T√≠tulos y textos con colores naturaleza */
        h1, h2 { color: #065f46; } /* Tailwind text-emerald-800 */
        p, span:not(.slider) { color: #047857; } /* Tailwind text-emerald-700, excluyendo el slider */
        #score { color: #059669; } /* Tailwind text-emerald-600 */
        #finalScore { color: #a16207; } /* Tailwind text-yellow-700 - Mantener puntaje destacado */
        #questionCategory { color: #15803d; } /* Tailwind text-green-700 */
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="quizApp" class="quiz-container w-full max-w-2xl p-6 md:p-10 text-center">

        <div id="startScreen" class="fade-in">
            <h1 class="text-3xl md:text-4xl font-bold mb-4 mt-8">üå≥ ¬°Aventura Animal y Vegetal! üçÉ</h1>
            <p class="text-lg mb-6">Si vas al Sarmiento y sos de 4b entonces esto te va a interesar...</p>

            <div class="flex items-center justify-center space-x-3 mb-8">
                <span class="text-sm font-medium">Preguntas Ordenadas</span>
                <label class="switch">
                    <input type="checkbox" id="randomModeToggle">
                    <span class="slider"></span>
                </label>
                <span class="text-sm font-medium">Modo Aleatorio</span>
            </div>

            <button id="startButton" class="main-button text-xl">
                <i class="fas fa-play"></i>¬°Comenzar Aventura!
            </button>
        </div>

        <div id="gameScreen" class="hidden">
            <div class="flex justify-between items-center mb-4">
                <p class="text-xl font-bold">Puntaje: <span id="score">0</span></p>
                <p class="text-sm font-medium"><span id="modeInfo"></span> Pregunta <span id="questionNumber">1</span> de <span id="totalQuestions"></span></p>
            </div>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar" style="width: 0%;"></div>
            </div>
            <div id="questionArea" class="mb-6 min-h-[100px]">
                 <h2 id="questionText" class="text-2xl font-semibold mb-2"></h2>
                <p id="questionCategory" class="text-sm font-medium mb-4"></p>
            </div>
            <div id="optionsArea" class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                </div>
            <div id="feedbackArea" class="h-10 text-lg font-semibold">
                </div>
        </div>

        <div id="endScreen" class="hidden">
             <h2 id="endScreenTitle" class="text-3xl md:text-4xl font-bold mb-4 mt-8">¬°Aventura Completada!</h2>
            <p class="text-2xl mb-2">Tu puntaje final es:</p>
            <p id="finalScore" class="text-5xl font-bold mb-8"></p>
            <p id="finalMessage" class="text-lg mb-8"></p>
            <div class="flex flex-col sm:flex-row justify-center items-center gap-4">
                <button id="reviewButton" class="main-button hidden text-lg">
                    <i class="fas fa-redo-alt"></i>Repasar Incorrectas
                </button>
                <button id="restartButton" class="main-button text-lg">
                    <i class="fas fa-gamepad"></i>Jugar de Nuevo
                </button>
                <button id="whatsappShareButton" class="main-button text-lg">
                     <i class="fab fa-whatsapp"></i>Compartir
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Preguntas de la Trivia (Ordenadas por categor√≠a por defecto) ---
        const questions = [
            // --- 1. CARACTER√çSTICAS GENERALES Y CLASIFICACI√ìN ---
            { category: "Caracter√≠sticas de Seres Vivos", question: "Todos los seres vivos, desde una bacteria hasta una ballena, est√°n formados por unidades muy peque√±as llamadas...", options: ["√Åtomos", "Mol√©culas", "C√©lulas", "√ìrganos"], correctAnswer: "C√©lulas" },
            { category: "Caracter√≠sticas de Seres Vivos", question: "Cuando una planta crece orientando sus hojas hacia la luz del sol, est√° respondiendo a un...", options: ["Reflejo", "Instinto", "Est√≠mulo", "H√°bito"], correctAnswer: "Est√≠mulo" },
            { category: "Caracter√≠sticas de Seres Vivos", question: "La capacidad de los seres vivos de tener 'hijos' o descendencia se llama:", options: ["Nutrici√≥n", "Respiraci√≥n", "Reproducci√≥n", "Adaptaci√≥n"], correctAnswer: "Reproducci√≥n" },
            { category: "La Clasificaci√≥n", question: "Cuando agrupamos seres vivos con caracter√≠sticas similares (como 'animales con plumas'), estamos haciendo una...", options: ["Colecci√≥n", "Mezcla", "Clasificaci√≥n", "Adivinanza"], correctAnswer: "Clasificaci√≥n" },
            { category: "La Clasificaci√≥n", question: "¬øPara qu√© sirve clasificar los seres vivos?", options: ["Para que ocupen menos espacio", "Para estudiarlos y entenderlos mejor", "Para que no se peleen entre ellos", "Para darles nombres dif√≠ciles"], correctAnswer: "Para estudiarlos y entenderlos mejor" },

            // --- 2. PLANTAS ---
            // Plantas: Fotos√≠ntesis y Partes
            { category: "Plantas: Alimentaci√≥n", question: "¬øC√≥mo se llama el proceso donde las plantas fabrican su propio alimento usando la luz del sol?", options: ["Respiraci√≥n", "Fotos√≠ntesis", "Digesti√≥n", "Absorci√≥n"], correctAnswer: "Fotos√≠ntesis" },
            { category: "Plantas: Alimentaci√≥n", question: "Adem√°s de alimento, ¬øqu√© gas importante para la respiraci√≥n de los animales liberan las plantas durante la fotos√≠ntesis?", options: ["Di√≥xido de Carbono", "Nitr√≥geno", "Ox√≠geno", "Vapor de agua"], correctAnswer: "Ox√≠geno" },
            { category: "Plantas: Partes", question: "¬øQu√© parte de la planta se encarga principalmente de absorber agua y nutrientes del suelo?", options: ["Hojas", "Flores", "Tallo", "Ra√≠z"], correctAnswer: "Ra√≠z" },
            { category: "Plantas: Partes", question: "Adem√°s de absorber agua, ¬øqu√© otra funci√≥n importante cumplen las ra√≠ces para la planta?", options: ["Producir flores", "Realizar fotos√≠ntesis", "Sujetar la planta al suelo", "Atraer insectos"], correctAnswer: "Sujetar la planta al suelo" },
            { category: "Plantas: Partes", question: "¬øCu√°l es la funci√≥n principal del tallo en una planta?", options: ["Absorber luz solar", "Sostener las hojas, flores y frutos", "Producir semillas", "Absorber agua"], correctAnswer: "Sostener las hojas, flores y frutos" },
            { category: "Plantas: Partes", question: "Las hojas son como las 'cocinas' de la planta porque all√≠ ocurre principalmente la...", options: ["Absorci√≥n de agua", "Producci√≥n de flores", "Fotos√≠ntesis", "Fijaci√≥n al suelo"], correctAnswer: "Fotos√≠ntesis" },
            { category: "Plantas: Partes", question: "En muchas plantas, ¬øqu√© parte se encarga de la reproducci√≥n y luego se transforma en fruto?", options: ["La ra√≠z", "El tallo", "La hoja", "La flor"], correctAnswer: "La flor" },
            // Plantas: Clasificaci√≥n (del cuadro)
            { category: "Plantas: Clasificaci√≥n por Tama√±o", question: "Si ves una planta muy bajita, con el tallo blandito y verde como el c√©sped, ¬øc√≥mo la clasificar√≠as seg√∫n su tama√±o?", options: ["√Årbol", "Arbusto", "Hierba"], correctAnswer: "Hierba" },
            { category: "Plantas: Clasificaci√≥n por Tama√±o", question: "El jazm√≠n tiene varios tallos m√°s duros (le√±osos) que salen desde cerca del suelo. ¬øEn qu√© grupo lo ponemos seg√∫n su tama√±o?", options: ["Hierba", "Arbusto", "√Årbol"], correctAnswer: "Arbusto" },
            { category: "Plantas: Clasificaci√≥n por Tama√±o", question: "¬øCu√°l de estos es un ejemplo de √ÅRBOL seg√∫n el cuadro?", options: ["Pasto", "Jacarand√°", "Jazm√≠n"], correctAnswer: "Jacarand√°" },
            { category: "Plantas: Clasificaci√≥n por Ambiente", question: "Las plantas que viven completamente dentro del agua o flotando en ella, como los camalotes, se llaman...", options: ["Aeroterrestres", "Acu√°ticas", "Anfibias"], correctAnswer: "Acu√°ticas" },
            { category: "Plantas: Clasificaci√≥n por Ambiente", question: "El palo borracho crece fijo en la tierra. ¬øC√≥mo se clasifica seg√∫n el ambiente donde vive?", options: ["Aeroterrestre", "Acu√°tica", "Anfibia"], correctAnswer: "Aeroterrestre" },
            { category: "Plantas: Clasificaci√≥n por Ambiente", question: "Los juncos crecen en lugares muy h√∫medos, a veces con una parte bajo el agua. ¬øA qu√© grupo pertenecen seg√∫n el ambiente?", options: ["Aeroterrestres", "Acu√°ticas", "Anfibias"], correctAnswer: "Anfibias" },
            { category: "Plantas: Clasificaci√≥n por Reproducci√≥n", question: "El jacarand√° y el jazm√≠n tienen algo en com√∫n en su forma de reproducirse. ¬øQu√© es?", options: ["Usan esporas", "Tienen flores y semillas", "Solo tienen semillas (sin flores vistosas)"], correctAnswer: "Tienen flores y semillas" },
            { category: "Plantas: Clasificaci√≥n por Reproducci√≥n", question: "Los pinos y los cipreses no tienen flores como las rosas, pero s√≠ producen algo para reproducirse. ¬øQu√© es?", options: ["Esporas", "Semillas (en conos o pi√±as)", "Flores peque√±as"], correctAnswer: "Semillas (en conos o pi√±as)" },
            { category: "Plantas: Clasificaci√≥n por Reproducci√≥n", question: "Si encuentras un helecho en un lugar h√∫medo, ¬øc√≥mo se reproduce principalmente?", options: ["Con flores y semillas", "Con semillas solamente", "Con esporas"], correctAnswer: "Con esporas" },
            // Otros Aut√≥trofos
            { category: "Otros Aut√≥trofos", question: "Adem√°s de las plantas, ¬øqu√© otros organismos acu√°ticos fabrican su alimento por fotos√≠ntesis y pueden ser de color verde, rojo o pardo?", options: ["Hongos", "Bacterias", "Algas", "Corales"], correctAnswer: "Algas" },

            // --- 3. ANIMALES ---
            // Animales: Generales
            { category: "Animales: Nutrici√≥n", question: "Los animales que NO pueden fabrican su propio alimento y deben comer otros seres vivos se llaman...", options: ["Aut√≥trofos", "Productores", "Heter√≥trofos", "Fotosint√©ticos"], correctAnswer: "Heter√≥trofos" },
            { category: "Animales: Estructura", question: "La principal diferencia para clasificar animales en vertebrados o invertebrados es la presencia o ausencia de:", options: ["Patas", "Alas", "Esqueleto interno", "Pelo"], correctAnswer: "Esqueleto interno" },
            // Animales: Vertebrados
            { category: "Vertebrados", question: "Los tiburones son peces especiales porque su esqueleto est√° hecho de un material flexible llamado...", options: ["Huesos duros", "Aire", "Cart√≠lago", "Escamas"], correctAnswer: "Cart√≠lago" },
            { category: "Vertebrados", question: "Seg√∫n la imagen, ¬øqu√© tipo de pez tiene esqueleto de cart√≠lago y branquias visibles?", options: ["Pez Payaso", "Pez √ìseo", "Tibur√≥n (Pez Cartilaginoso)", "Salamandra"], correctAnswer: "Tibur√≥n (Pez Cartilaginoso)" },
            { category: "Vertebrados", question: "La mayor√≠a de los peces, como el pez payaso, tienen un esqueleto de huesos y branquias ocultas. Pertenecen al grupo de peces...", options: ["Cartilaginosos", "√ìseos", "Pulmonados", "Abisales"], correctAnswer: "√ìseos" },
            { category: "Vertebrados", question: "El pez payaso es un ejemplo de pez √≥seo. ¬øQu√© tipo de esqueleto tienen estos peces?", options: ["De cart√≠lago", "No tienen esqueleto", "Formado por huesos", "Externo"], correctAnswer: "Formado por huesos" },
            { category: "Vertebrados", question: "¬øQu√© grupo de animales vertebrados, como los sapos, suelen nacer en el agua (renacuajos) y luego viven en la tierra, teniendo piel desnuda y h√∫meda?", options: ["Peces", "Anfibios", "Reptiles", "Mam√≠feros"], correctAnswer: "Anfibios" },
            { category: "Vertebrados", question: "Los sapos y ranas son anfibios. ¬øC√≥mo es su piel?", options: ["Con plumas", "Con escamas duras", "Desnuda y h√∫meda", "Con pelo"], correctAnswer: "Desnuda y h√∫meda" },
            { category: "Vertebrados", question: "Las serpientes y los cocodrilos tienen el cuerpo cubierto de escamas duras y la mayor√≠a nace de huevos. Son:", options: ["Anfibios", "Aves", "Reptiles", "Mam√≠feros"], correctAnswer: "Reptiles" },
            { category: "Vertebrados", question: "¬øTodos los reptiles, como los cocodrilos y las serpientes, tienen patas?", options: ["S√≠, todos tienen cuatro patas", "S√≠, todos tienen dos patas", "No, algunos como las serpientes no tienen patas", "No, ninguno tiene patas"], correctAnswer: "No, algunos como las serpientes no tienen patas" },
            { category: "Vertebrados", question: "¬øQu√© grupo de animales vertebrados se caracteriza por tener el cuerpo cubierto de plumas, pico y dos alas?", options: ["Mam√≠feros", "Reptiles", "Anfibios", "Aves"], correctAnswer: "Aves" },
            { category: "Vertebrados", question: "Las aves nacen de huevos con c√°scara dura. ¬øLos ping√ºinos son aves?", options: ["No, son peces", "No, son mam√≠feros", "S√≠, aunque no vuelen", "No, son reptiles"], correctAnswer: "S√≠, aunque no vuelen" },
            { category: "Vertebrados", question: "¬øCu√°l de estos animales es un mam√≠fero acu√°tico?", options: ["Tibur√≥n", "Ping√ºino", "Ballena", "Pulpo"], correctAnswer: "Ballena" },
            { category: "Vertebrados", question: "La caracter√≠stica principal que define a los mam√≠feros es que las hembras alimentan a sus cr√≠as con leche producida en sus:", options: ["Bolsas", "Mamas", "Picos", "Escamas"], correctAnswer: "Mamas" },
            { category: "Vertebrados", question: "Los osos, monos y seres humanos somos mam√≠feros terrestres. ¬øC√≥mo nacen la mayor√≠a de las cr√≠as de mam√≠feros?", options: ["De huevos", "Del vientre materno", "De capullos", "Se dividen solos"], correctAnswer: "Del vientre materno" },
            // Animales: Invertebrados
            { category: "Invertebrados", question: "Las esponjas de mar, que tienen un cuerpo lleno de poros y viven fijas a las rocas, son animales invertebrados del grupo de los:", options: ["Cnidarios", "Moluscos", "Por√≠feros", "An√©lidos"], correctAnswer: "Por√≠feros" },
            { category: "Invertebrados", question: "¬øC√≥mo obtienen su alimento las esponjas de mar (Por√≠feros)?", options: ["Cazando peces peque√±os", "Filtrando el agua a trav√©s de sus poros", "Comiendo algas", "Absorbiendo luz solar"], correctAnswer: "Filtrando el agua a trav√©s de sus poros" },
            { category: "Invertebrados", question: "Las medusas y los corales, con corpos blandos y tent√°culos, pertenecen al grupo de los...", options: ["Moluscos", "Cnidarios", "Artr√≥podos", "Equinodermos"], correctAnswer: "Cnidarios" },
            { category: "Invertebrados", question: "¬øQu√© estructura usan las medusas y an√©monas para capturar su alimento?", options: ["Pinzas", "Dientes", "Tent√°culos", "Una concha"], correctAnswer: "Tent√°culos" },
            { category: "Invertebrados", question: "Un caracol, que a menudo lleva su casa (concha) a cuestas, es un animal invertebrado del grupo de los...", options: ["Insectos", "An√©lidos", "Moluscos", "Crust√°ceos"], correctAnswer: "Moluscos" },
            { category: "Invertebrados", question: "¬øCu√°l de estos animales es un molusco SIN concha externa?", options: ["Almeja", "Caracol", "Mejill√≥n", "Pulpo"], correctAnswer: "Pulpo" },
            { category: "Invertebrados", question: "Las lombrices de tierra, con su cuerpo blando y dividido en muchos anillos, son ejemplos de:", options: ["Artr√≥podos", "Moluscos", "An√©lidos", "Cnidarios"], correctAnswer: "An√©lidos" },
            { category: "Invertebrados", question: "La caracter√≠stica m√°s visible del cuerpo de una lombriz de tierra (An√©lido) es que est√° formado por muchos...", options: ["Segmentos o anillos", "Tent√°culos", "Patas", "Escamas"], correctAnswer: "Segmentos o anillos" },
            { category: "Invertebrados", question: "¬øCu√°l es el grupo de animales invertebrados M√ÅS numeroso, que incluye insectos, ara√±as y cangrejos, caracterizados por tener un esqueleto externo y patas articuladas?", options: ["Moluscos", "An√©lidos", "Equinodermos", "Artr√≥podos"], correctAnswer: "Artr√≥podos" },
            { category: "Invertebrados", question: "La 'armadura' dura que protege el cuerpo de los insectos y cangrejos se llama:", options: ["Piel", "Escamas", "Esqueleto externo (exoesqueleto)", "Caparaz√≥n blando"], correctAnswer: "Esqueleto externo (exoesqueleto)" },
            { category: "Invertebrados", question: "¬øCu√°ntas patas tienen los insectos, como las hormigas o las abejas?", options: ["Cuatro", "Seis", "Ocho", "Muchas"], correctAnswer: "Seis" },
            { category: "Invertebrados", question: "Las ara√±as y los escorpiones, que tienen cuatro pares de patas, pertenecen al subgrupo de artr√≥podos llamado:", options: ["Insectos", "Crust√°ceos", "Ar√°cnidos", "Miri√°podos"], correctAnswer: "Ar√°cnidos" },
            { category: "Invertebrados", question: "Las estrellas de mar y los erizos de mar, que suelen tener espinas y un cuerpo con simetr√≠a radial (como una pizza), son...", options: ["Artr√≥podos", "Moluscos", "Cnidarios", "Equinodermos"], correctAnswer: "Equinodermos" },
            { category: "Invertebrados", question: "¬øD√≥nde viven principalmente las estrellas de mar y los erizos (Equinodermos)?", options: ["En la tierra", "En agua dulce (r√≠os)", "En el mar", "Volando por el aire"], correctAnswer: "En el mar" }
        ];


        // --- Variables del Juego ---
        let currentQuestionIndex = 0;
        let score = 0;
        let gameQuestions = []; // Array que contendr√° las preguntas actuales (ordenadas, aleatorias o de repaso)
        let incorrectlyAnsweredQuestions = []; // Para guardar las preguntas falladas
        let isRandomMode = false; // Variable para controlar el modo de juego
        let isReviewMode = false; // Variable para controlar si estamos en modo repaso

        // --- Elementos del DOM ---
        const startScreen = document.getElementById('startScreen');
        const gameScreen = document.getElementById('gameScreen');
        const endScreen = document.getElementById('endScreen');

        const startButton = document.getElementById('startButton');
        const restartButton = document.getElementById('restartButton');
        const reviewButton = document.getElementById('reviewButton'); // Bot√≥n de repaso
        const whatsappShareButton = document.getElementById('whatsappShareButton'); // Bot√≥n WhatsApp
        const randomModeToggle = document.getElementById('randomModeToggle'); // Interruptor

        const scoreDisplay = document.getElementById('score');
        const questionNumberDisplay = document.getElementById('questionNumber');
        const totalQuestionsDisplay = document.getElementById('totalQuestions');
        const progressBar = document.getElementById('progressBar');
        const modeInfo = document.getElementById('modeInfo'); // Para indicar si es repaso

        const questionText = document.getElementById('questionText');
        const questionCategory = document.getElementById('questionCategory');
        const optionsArea = document.getElementById('optionsArea');
        const feedbackArea = document.getElementById('feedbackArea');

        const finalScoreDisplay = document.getElementById('finalScore');
        const finalMessageDisplay = document.getElementById('finalMessage');
        const endScreenTitle = document.getElementById('endScreenTitle');


        // --- Funciones del Juego ---

        // Barajar preguntas (Algoritmo Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function startGame() {
            isRandomMode = randomModeToggle.checked;
            isReviewMode = false;
            incorrectlyAnsweredQuestions = [];

            startScreen.classList.add('hidden');
            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('fade-in');
            modeInfo.textContent = "";

            currentQuestionIndex = 0;
            score = 0;
            scoreDisplay.textContent = score;

            gameQuestions = [...questions];
            if (isRandomMode) {
                shuffleArray(gameQuestions);
            }

            totalQuestionsDisplay.textContent = gameQuestions.length;
            loadQuestion();
        }

        function startReviewRound() {
            isReviewMode = true;
            gameQuestions = [...incorrectlyAnsweredQuestions];
            incorrectlyAnsweredQuestions = [];
            currentQuestionIndex = 0;

            endScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            gameScreen.classList.add('fade-in');
            modeInfo.textContent = "(Repaso)";
            totalQuestionsDisplay.textContent = gameQuestions.length;
            reviewButton.classList.add('hidden');

            loadQuestion();
        }


        function loadQuestion() {
            if (currentQuestionIndex < gameQuestions.length) {
                const currentQuestion = gameQuestions[currentQuestionIndex];

                const progress = ((currentQuestionIndex + 1) / gameQuestions.length) * 100;
                progressBar.style.width = `${progress}%`;

                questionNumberDisplay.textContent = currentQuestionIndex + 1;
                questionText.textContent = currentQuestion.question;
                questionCategory.textContent = `Categor√≠a: ${currentQuestion.category}`;

                optionsArea.innerHTML = '';
                feedbackArea.innerHTML = '';
                feedbackArea.className = 'h-10 text-lg font-semibold';

                const currentOptions = [...currentQuestion.options];
                shuffleArray(currentOptions);

                currentOptions.forEach(option => {
                    const button = document.createElement('button');
                    button.textContent = option;
                    button.classList.add(
                        'option-button', 'w-full', 'font-semibold',
                        'py-3', 'px-4', 'rounded-lg', 'border-2',
                        'focus:outline-none', 'focus:ring-2', 'focus:ring-opacity-50',
                        'fade-in',
                        'bg-green-100', 'text-green-800', 'border-green-300',
                        'hover:bg-green-200', 'hover:border-green-400', 'focus:ring-green-500'
                    );
                    button.onclick = () => checkAnswer(option, currentQuestion.correctAnswer, button, currentQuestion);
                    optionsArea.appendChild(button);
                });

                document.getElementById('questionArea').classList.remove('fade-in');
                void document.getElementById('questionArea').offsetWidth;
                document.getElementById('questionArea').classList.add('fade-in');

                optionsArea.childNodes.forEach((node, index) => {
                    node.style.animationDelay = `${index * 0.1}s`;
                    node.classList.remove('fade-in');
                    void node.offsetWidth;
                    node.classList.add('fade-in');
                });

            } else {
                if (isReviewMode) {
                    isReviewMode = false;
                    showEndScreen(true);
                } else {
                    showEndScreen(false);
                }
            }
        }

        function checkAnswer(selectedOption, correctAnswer, button, currentQuestionObject) {
            const optionButtons = optionsArea.getElementsByTagName('button');
            for (let btn of optionButtons) {
                btn.disabled = true;
                if (btn.textContent === correctAnswer) {
                    btn.classList.add('correct-answer');
                    btn.classList.remove('bg-green-100', 'text-green-800', 'border-green-300', 'hover:bg-green-200', 'hover:border-green-400');
                }
            }

            if (selectedOption === correctAnswer) {
                if (!isReviewMode) {
                    score += 10;
                    scoreDisplay.textContent = score;
                }
                button.classList.add('correct-answer');
                button.classList.remove('bg-green-100', 'text-green-800', 'border-green-300', 'hover:bg-green-200', 'hover:border-green-400');
                feedbackArea.innerHTML = `
                    <div class="flex items-center justify-center text-green-700">
                        <svg class="feedback-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        ¬°Correcto! ${!isReviewMode ? '+10 puntos' : ''}
                    </div>`;
            } else {
                if (!isReviewMode) {
                    if (!incorrectlyAnsweredQuestions.some(q => q.question === currentQuestionObject.question)) {
                         incorrectlyAnsweredQuestions.push(currentQuestionObject);
                    }
                }
                button.classList.add('incorrect-answer');
                 button.classList.remove('bg-green-100', 'text-green-800', 'border-green-300', 'hover:bg-green-200', 'hover:border-green-400');
                feedbackArea.innerHTML = `
                    <div class="flex items-center justify-center text-red-700">
                        <svg class="feedback-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        ¬°Ups! La respuesta era ${correctAnswer}.
                    </div>`;
            }

            currentQuestionIndex++;
            const delay = selectedOption === correctAnswer ? 1500 : 2500;
            setTimeout(loadQuestion, delay);
        }

        function showEndScreen(fromReview) {
            gameScreen.classList.add('hidden');
            endScreen.classList.remove('hidden');
            endScreen.classList.add('fade-in');
            modeInfo.textContent = "";

            finalScoreDisplay.textContent = score;
            let message = "";

            if (score >= questions.length * 10 * 0.8) {
                message = "¬°Eres un Genio de la Naturaleza! üå≥ ¬°Sabes much√≠simo!";
                endScreenTitle.textContent = "¬°Felicitaciones! üéâ";
            } else if (score >= questions.length * 10 * 0.5) {
                message = "¬°Muy bien! Eres un gran explorador del mundo vivo. üå±";
                 endScreenTitle.textContent = "¬°Buen Trabajo! üëç";
            } else {
                message = "¬°Buen intento! Sigue aprendiendo y ser√°s un experto. ü¶ã";
                 endScreenTitle.textContent = "¬°Aventura Completada!";
            }
            finalMessageDisplay.textContent = message;

            if (incorrectlyAnsweredQuestions.length > 0 && !fromReview) {
                reviewButton.classList.remove('hidden');
            } else {
                reviewButton.classList.add('hidden');
            }
        }

        function shareOnWhatsApp() {
            const totalPossibleScore = questions.length * 10;
            // Mensaje actualizado con la URL proporcionada
            let message = `¬°Termin√© la trivia "Aventura Animal y Vegetal" con ${score} de ${totalPossibleScore} puntos! üå≥üçÉ ¬øTe animas a probar tus conocimientos?\n\nJuega aqu√≠: https://mtoselli81.github.io/marcostoselli/`;

            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // --- Event Listeners ---
        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);
        reviewButton.addEventListener('click', startReviewRound);
        whatsappShareButton.addEventListener('click', shareOnWhatsApp);


        // Iniciar la pantalla de bienvenida
        startScreen.classList.remove('hidden');

    </script>
</body>
</html>
